---
import Layout from '../layouts/Layout.astro';
import PasswordSettings from '../components/PasswordSettings.svelte';
import PaymentSettings from '../components/PaymentSettings.svelte';
import ApiSettings from '../components/ApiSettings.svelte';
---

<Layout title="Account | TaskRatchet">
	<div class="container">
		<h1>Account</h1>

		<div id="loading" class="loading">Loading account...</div>
		<div id="content" style="display: none;">
			<h2>Reset Password</h2>
			<PasswordSettings client:load />

			<h2>Update Payment Details</h2>
			<PaymentSettings client:load />

			<h2>API</h2>
			<ApiSettings client:load />
		</div>
	</div>
</Layout>

<style>
	.container {
		max-width: 800px;
		margin: 0 auto;
		padding: 1rem;
	}

	.loading {
		text-align: center;
		padding: 2rem;
		color: var(--color);
	}

	.error {
		color: red;
		text-align: center;
		padding: 2rem;
	}
</style>

<script>
	import { getMe } from '@taskratchet/sdk';

	// Hide loading and show content once we confirm the user is logged in
	getMe().then(() => {
		document.getElementById('loading')?.style.setProperty('display', 'none');
		document.getElementById('content')?.style.setProperty('display', 'block');
	}).catch(e => {
		document.getElementById('loading')?.style.setProperty('display', 'none');
		const error = e instanceof Error ? e.message : 'Failed to load account';
		document.getElementById('loading')?.insertAdjacentHTML('afterend', 
			`<div class="error">Error: ${error}</div>`
		);
	});
</script>
